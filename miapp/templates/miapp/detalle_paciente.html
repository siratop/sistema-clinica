{% extends 'miapp/base.html' %}
{% block content %}

<div class="card shadow-sm border-0 mb-4 border-start border-5 border-success">
    <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h2 class="fw-bold text-success">{{ paciente.nombre }} {{ paciente.apellido }}</h2>
                <p class="text-muted mb-0"><i class="fa-solid fa-id-card"></i> {{ paciente.cedula }} | <i class="fa-solid fa-cake-candles"></i> {{ paciente.edad }} años</p>
            </div>
            <div class="text-end">
                <a href="{% url 'lista_pacientes' %}" class="btn btn-outline-secondary btn-sm">Volver</a>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-md-3"><strong><i class="fa-solid fa-envelope"></i> Correo:</strong><br>{{ paciente.correo|default:"--" }}</div>
            <div class="col-md-3"><strong><i class="fa-solid fa-phone"></i> Teléfono:</strong><br>{{ paciente.telefono }}</div>
            <div class="col-md-6"><strong><i class="fa-solid fa-notes-medical"></i> Alergias/Crónicas:</strong><br>
                {{ paciente.alergias }} / {{ paciente.enfermedades_cronicas }}
            </div>
        </div>
    </div>
</div>

<h3 class="mb-3 text-secondary"><i class="fa-solid fa-clock-rotate-left"></i> Historial de Consultas</h3>

<div class="accordion shadow-sm" id="historialAccordion">
    {% for cita in historial %}
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#cita{{ cita.id }}">
                <div class="d-flex w-100 justify-content-between align-items-center pe-3">
                    <span>
                        <strong>{{ cita.fecha|date:"d/m/Y" }}</strong> - 
                        <span class="text-success">{{ cita.medico.perfilusuario.especialidad.nombre|default:"Consulta General" }}</span>
                        (Dr. {{ cita.medico.last_name }})
                    </span>
                    
                    {% if cita.realizada %}
                        <span class="badge bg-success"><i class="fa-solid fa-check"></i> Realizada / Pagada</span>
                    {% else %}
                        <span class="badge bg-warning text-dark"><i class="fa-solid fa-clock"></i> Pendiente</span>
                    {% endif %}
                </div>
            </button>
        </h2>
        <div id="cita{{ cita.id }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" data-bs-parent="#historialAccordion">
            <div class="accordion-body bg-light">
                <div class="row">
                    <div class="col-md-6">
                        <strong class="text-primary">Motivo de Consulta:</strong>
                        <p>{{ cita.motivo }}</p>
                    </div>
                    <div class="col-md-6">
                        <strong class="text-success">Diagnóstico:</strong>
                        <p>{{ cita.diagnostico|default:"Sin diagnóstico registrado." }}</p>
                    </div>
                </div>
                {% if cita.realizada %}
                <div class="mt-2 border-top pt-2">
                    <strong>Tratamiento:</strong> {{ cita.tratamiento|default:"--" }}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="alert alert-info">Este paciente no tiene historial de citas.</div>
    {% endfor %}
</div>
{% endblock %}